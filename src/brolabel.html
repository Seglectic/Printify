<!DOCTYPE html>
<html>
  <head>
    <title>P3D Printify - Brother Label</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
      * {
        user-select: none;
      }
      body {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        font-family: Arial, sans-serif;
        background-color: white;
        margin: 0;
      }
      .panel {
        border: 2px dashed #ccc;
        border-radius: 4px;
        padding: 30px 40px;
        text-align: center;
        min-width: 280px;
      }
      .panel h1 {
        font-size: 18px;
        margin: 0 0 20px 0;
      }
      .row {
        margin: 12px 0;
      }
      select, input {
        font-size: 14px;
        padding: 6px 8px;
      }
      input {
        width: 220px;
      }
      button {
        margin-top: 8px;
        padding: 8px 18px;
        cursor: pointer;
      }
      #status {
        margin-top: 12px;
        font-size: 13px;
        color: #555;
      }
      .hidden-div {
        display: none;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 9999;
      }
    </style>
  </head>
  <body>
    <div class="panel">
      <h1>Brother PTE-550W</h1>
      <div class="row">
        <label for="tapeSize">Tape Size</label>
        <select id="tapeSize">
          <option value="12">12 mm</option>
          <option value="24">24 mm</option>
        </select>
      </div>
      <div class="row">
        <label for="labelText">Text</label>
        <br />
        <input id="labelText" type="text" placeholder="Label text" />
      </div>
      <button id="printBtn">Print</button>
      <div id="status"></div>
    </div>

    <div id="vid-container" class="hidden-div">
      <video id="video" src="checkMark.mp4" width="800" height="600"></video>
    </div>

    <script>
      function showConfirm(){
        var video = $('#video')[0];
        var fadeOutDelay = 650;
        video.currentTime = 0;
        video.playbackRate = 2;
        video.play();
        $('#vid-container').show();
        setTimeout(function() {
          $('#vid-container').fadeOut('fast');
        }, fadeOutDelay);
      }

      $('#printBtn').on('click', function(){
        const tapeSize = $('#tapeSize').val();
        const text = $('#labelText').val().trim();
        if (!text) {
          $('#status').text('Please enter label text.');
          return;
        }

        $('#status').text('Printing...');
        fetch('/labelmake', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ tapeSize: tapeSize, text: text })
        })
        .then((response) => {
          if (response.ok) {
            $('#status').text('Sent to printer.');
            showConfirm();
          } else {
            $('#status').text('Print failed.');
          }
        })
        .catch(() => {
          $('#status').text('Error sending print.');
        });
      });
    </script>
  </body>
</html>
